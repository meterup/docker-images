#!/usr/bin/env bash

set -euo pipefail

main() {
    # MIT Licensed.
    # curl, ca-certificates: parse certificate, asc key from postgres server
    # gnupg: necessary for apt-key add
    # libpq-dev: Ruby Postgres client
    # libsodium-dev: necessary for the Ruby nacl binding
    # sudo: used in codebuild to assume permissions of a non-root user
    apt-get update && apt-get install -y --no-install-recommends \
        curl ca-certificates unzip make autoconf gcc zlib1g-dev \
        gettext libssl-dev \
        libcurl4-openssl-dev g++ gnupg \
        libsodium-dev \
        time \
        sudo
    curl --silent --show-error https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add -
    echo "deb http://apt.postgresql.org/pub/repos/apt/ bionic-pgdg main" >> /etc/apt/sources.list.d/pgdg.list
    apt-get update
    apt-get install -y --no-install-recommends postgresql-client-11 libpq-dev
}

main "$@"
