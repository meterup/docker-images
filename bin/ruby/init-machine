#!/usr/bin/env bash

set -euo pipefail

main() {
    id -u meter &>/dev/null || useradd --create-home meter
    getent group meter &>/dev/null || groupadd meter

    mkdir -p /etc/meter-environment.d
    echo "UTC" > /etc/meter-environment.d/TZ
    echo "docker" > /etc/meter-environment.d/MACHINE_TYPE
    if [[ -n "${REALM:-}" ]]; then
        echo "${REALM}" > /etc/meter-environment.d/REALM
    fi
    chown -R meter:meter /etc/meter-environment.d
    chmod 755 /etc/meter-environment.d
}

main "$@"
